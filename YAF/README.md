# YAF is Yet Another Flowmeter
It processes packet data from pcap(3) dumpfiles as generated by tcpdump(1) or via live capture from an interface using pcap(3) into bidirectional flows, then exports those flows to IPFIX Collecting Processes or in an IPFIX-based file format. YAF's output can be used with the SiLK flow analysis tools, super_mediator, Pipeline 5, and any other IPFIX compliant toolchain.  
Source: https://tools.netsa.cert.org/yaf/index.html  

# Install on Ubuntu 20.04
https://tools.netsa.cert.org/yaf/libyaf/yaf_silk.html  

```bash
# Requirements
apt install build-essential libglib2.0-dev libfixbuf-dev libpcre3 libpcre3-dev libpcap-dev libpcap0.8 libndpi2.6 libndpi-dev libfixbuf9 libfixbuf-dev

# Version 2.12.2
#https://tools.netsa.cert.org/yaf/download.html
wget https://tools.netsa.cert.org/releases/yaf-2.12.2.tar.gz
tar xvzf yaf-2.12.2.tar.gz
cd yaf-2.12.2

# --enable-entropy        enable the packet payload entropy calculation [default=no].
# --enable-ndpi           Enable NDPI application labeling
# Support for application labeling requires giving the --enable-applabel option to ./configure.
# Support for p0f requires giving the --enable-p0fprinter and --enable-applabel options to ./configure.
# Deep Packet Inspection (DPI) requires plugin support. Use the --enable-plugins option to ./configure.

# No p0f support
./configure --enable-applabel --enable-plugins --enable-ndpi --enable-entropy

make
make install

# Create symbolic links
ln -s /usr/local/lib/libyaf-2.12.2.so.4 /lib/x86_64-linux-gnu/libyaf-2.12.2.so.4
ln -s /usr/local/lib/libairframe-2.12.2.so.4  /lib/x86_64-linux-gnu/libairframe-2.12.2.so.4
```

### Build Silk
https://tools.netsa.cert.org/silk/
```bash
wget https://tools.netsa.cert.org/releases/silk-3.19.1.tar.gz
tar -xvzf silk-3.19.1.tar.gz
cd silk-3.19.1
./configure --with-libfixbuf=/usr/local/lib/pkgconfig --enable-ipv6
make
make install

# Create symbolic links
ln -s /usr/local/lib/libflowsource.so.19 /lib/x86_64-linux-gnu/libflowsource.so.19
ln -s /usr/local/lib/libsilk-thrd.so.5 /lib/x86_64-linux-gnu/libsilk-thrd.so.5
ln -s /usr/local/lib/libsilk.so.25 /lib/x86_64-linux-gnu/libsilk.so.25
```

# Using YAF with PCAP

## Ipfix file
```bash
# Create ipfix file from pcap
yaf --in test.pcap --out test.ipfix

# View features
yafscii --in test.ipfix  --tabular

# Convert to CSV
yafscii --in test.ipfix --out - --tabular --print-header > flow_features.tabular
# Remove blank spaces and replace '|' to ','
sed -e 's/ //g' -e 's/|/,/g' flow_features.tabular  > flow_features.csv
```


## Silk flow  
https://tools.netsa.cert.org/yaf/libyaf/yaf_pcap.html  
First, we could create SiLK flow data from this PCAP using rwipfix2silk: 
```bash
yaf --in ./test.pcap --out - --applabel --max-payload=1500 --silk | rwipfix2silk --silk-output=./test_yaf2flow.rw --interface-values=vlan

rwfileinfo test_yaf2flow.rw

# use rwstat and rwfilter to analyse test_yaf2flow.rw
```
